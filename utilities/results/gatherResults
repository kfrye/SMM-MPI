#!/usr/bin/python
__author__ = 'kmacarenco'

import json
import os
import argparse
import re

parser = argparse.ArgumentParser(description='To get test folder path')
parser.add_argument('-r', dest='resultsLoc', type=str, help='Results folder location', required=True)

args = parser.parse_args()


resultDict = {}


print "Gathering Results"

#For example results are in ../results/ep/...
tests = os.listdir(args.resultsLoc) #list of folder in ../results/..
for test in tests:
    if test.startswith("."):
        continue
    resultsDirPath = args.resultsLoc + "/" + test + "/"
    try:
        files = os.listdir(resultsDirPath)
    except OSError:
        continue
    resultDict[test] = []
    for f in files:
        if f.startswith("."):
            continue
        with open(resultsDirPath + f, 'r') as result:
            thisItem = {}
            for line in result:
                l = line.strip()
                l = re.sub(r'[ ]*=[ ]*', '=', l)
                a = l.split("=")
                if len(l.split("=")) == 2:
                    s = a[0]
                    s = re.sub(r'  ', '', s)
                    s = re.sub(r'  ', '', s)
                    s = re.sub(r'[.]', '', s)
                    s = re.sub(r' |[/]', '_', s)
                    s = s.upper()
                    rs = re.sub(r'  ', '', a[1])
                    thisItem[s] = rs;
        if not len(thisItem) == 0:
            resultDict[test].append(thisItem)

outfile = 'data.txt'
try:
    os.remove(outfile)
except OSError:
    pass

with open(outfile, 'w') as outfile:
    json.dump(resultDict, outfile)

