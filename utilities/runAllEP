#!/bin/bash

if [[ "$#" -ne 5 ]] && [[ "$#" -ne 6 ]]; then
    echo "Usage: run min max hostfile testtype sizesfile [extension]"
    exit 1
fi

if [[ "$#" -eq 5 ]]; then
    EXT=$6
else
    EXT=""
fi

updateSmmProject


MAXRUN=6
MIN=$1
MAX=$2
HOSTFILE=$3
TESTTYPE=$4
x=$MAX
r=1

STARTTIME=`date +%s`
#for j in S W A B C D; do
#for j in D; do
while read j; do
#for j in E; do
#for j in D E; do
    while [ $x -ge $MIN ]; do
        while [ $r -le $MAXRUN ]; do
            echo $i $j $x
            if ! testRunner $TESTTYPE $HOSTFILE $j $x $MIN $EXT ; then
                echo "test exited with error"
                break
            fi
            echo $?
            r=$(($r+1))
        done
        r=1
        x=$(($x-1))
    done
    x=$2
done < $5
ENDTIME=`date +%s`
TOTALTIME=$((($ENDTIME-$STARTTIME)/60))

receiver="konstan2@pdx.edu"
subj="Autogenerated email: Script complete"
message="Script $1 $2 $3 $4 completed Total runtime: $TOTALTIME min."
ssh linuxlab "mail -s \"$subj\" $receiver <<< \"$message\""
