#!/bin/bash

if [[ "$#" -ne 4 ]]; then
    echo "Usage: run min max hostfile testtype"
    exit 1
fi

MAXRUN=6
MIN=$1
MAX=$2
HOSTFILE=$3
TESTTYPE=$4
x=$MAX
r=1

STARTTIME=`date +%s`
for j in S W A B C D; do
#for j in E; do
#for j in D E; do
    while [ $x -ge $MIN ]; do
        while [ $r -le $MAXRUN ]; do
            echo $i $j $x
            testRunner $TESTTYPE $HOSTFILE $j $x $MIN
            r=$(($r+1))
        done
        r=1
        x=$(($x/2))
    done
    x=$2
done
ENDTIME=`date +%s`
TOTALTIME=$((($ENDTIME-$STARTTIME)/60))

receiver="konstan2@pdx.edu"
subj="Autogenerated email: Script complete"
message="Script $1 $2 $3 $4 completed Total runtime: $TOTALTIME min."
ssh linuxlab "mail -s \"$subj\" $receiver <<< \"$message\""
